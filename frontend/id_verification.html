<script>
    document.addEventListener("DOMContentLoaded", function () {
        var idVerificationForm = document.querySelector('form[name="id_verification_form"]');
        if (!idVerificationForm) return;
        // file upload
        var uploadInput = idVerificationForm.querySelector('.upload-btn input');
        var fileInfo = idVerificationForm.querySelector('.file-info');
        var fileNameSpan = idVerificationForm.querySelector('.file-name');
        var deleteIcon = idVerificationForm.querySelector('.delete-file');
        var errorMessage = idVerificationForm.querySelector('.id-file-error');

        uploadInput.addEventListener('change', () => {
            if (uploadInput.files.length) {
                errorMessage.style.display = 'none';
                fileNameSpan.textContent = uploadInput.files[0].name;
                fileInfo.style.display = 'flex';
            }
        });

        // Delete file
        deleteIcon.addEventListener('click', () => {
            uploadInput.value = '';
            fileInfo.style.display = 'none';
        });

        idVerificationForm.addEventListener("submit", function(event) {
            event.preventDefault(); // stop form submission
            event.stopImmediatePropagation();
            var formData = new FormData(this);
            if (!uploadInput.files || uploadInput.files.length === 0) {
                errorMessage.style.display = 'block';
                return;
            }
            errorMessage.style.display = 'none';
            setTimeout(() => {
                idVerificationForm.reset();
                history.pushState(null, '', '/apply/?voided-check-verification');
                var step = window.location.search.replace("?", "");
                applyToStep(step);
            }, 1500);

        }, true);
    });
</script>